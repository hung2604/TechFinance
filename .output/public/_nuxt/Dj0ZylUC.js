import{U as Q,V as re,f as te,a5 as W,a6 as le,a9 as ue,p as ae,r as w,g as j,j as se,L as de,o as q,w as u,a as s,M as ce,T as ge,x as i,y as ie,P as me,aj as pe,n as fe,C as be,c as J,b as g,A as ve,q as he,d as m,t as l,D as xe,O as ye}from"./oqaamrP9.js";import{_ as _e}from"./BNekpQR3.js";import{_ as De}from"./CpnDDUUJ.js";import{_ as we}from"./DSWG5mB1.js";import{_ as ke}from"./BgNR3wsS.js";import{_ as Se}from"./DaOrRE6X.js";import{_ as Te}from"./CGHGiu4z.js";import{u as Z}from"./DuJY48Vi.js";import"./CRmWZ7WG.js";import"./C4ent8x3.js";import"./VH0Qlokb.js";const Ve={slots:{root:"relative inline-flex items-center",base:["w-full rounded-[calc(var(--ui-radius)*1.5)] border-0 placeholder:text-(--ui-text-dimmed) focus:outline-none disabled:cursor-not-allowed disabled:opacity-75","transition-colors"],leading:"absolute inset-y-0 start-0 flex items-center",leadingIcon:"shrink-0 text-(--ui-text-dimmed)",leadingAvatar:"shrink-0",leadingAvatarSize:"",trailing:"absolute inset-y-0 end-0 flex items-center",trailingIcon:"shrink-0 text-(--ui-text-dimmed)"},variants:{buttonGroup:{horizontal:{root:"group",base:"group-not-only:group-first:rounded-e-none group-not-only:group-last:rounded-s-none group-not-last:group-not-first:rounded-none"},vertical:{root:"group",base:"group-not-only:group-first:rounded-b-none group-not-only:group-last:rounded-t-none group-not-last:group-not-first:rounded-none"}},size:{xs:{base:"px-2 py-1 text-xs gap-1",leading:"ps-2",trailing:"pe-2",leadingIcon:"size-4",leadingAvatarSize:"3xs",trailingIcon:"size-4"},sm:{base:"px-2.5 py-1.5 text-xs gap-1.5",leading:"ps-2.5",trailing:"pe-2.5",leadingIcon:"size-4",leadingAvatarSize:"3xs",trailingIcon:"size-4"},md:{base:"px-2.5 py-1.5 text-sm gap-1.5",leading:"ps-2.5",trailing:"pe-2.5",leadingIcon:"size-5",leadingAvatarSize:"2xs",trailingIcon:"size-5"},lg:{base:"px-3 py-2 text-sm gap-2",leading:"ps-3",trailing:"pe-3",leadingIcon:"size-5",leadingAvatarSize:"2xs",trailingIcon:"size-5"},xl:{base:"px-3 py-2 text-base gap-2",leading:"ps-3",trailing:"pe-3",leadingIcon:"size-6",leadingAvatarSize:"xs",trailingIcon:"size-6"}},variant:{outline:"text-(--ui-text-highlighted) bg-(--ui-bg) ring ring-inset ring-(--ui-border-accented)",soft:"text-(--ui-text-highlighted) bg-(--ui-bg-elevated)/50 hover:bg-(--ui-bg-elevated) focus:bg-(--ui-bg-elevated) disabled:bg-(--ui-bg-elevated)/50",subtle:"text-(--ui-text-highlighted) bg-(--ui-bg-elevated) ring ring-inset ring-(--ui-border-accented)",ghost:"text-(--ui-text-highlighted) bg-transparent hover:bg-(--ui-bg-elevated) focus:bg-(--ui-bg-elevated) disabled:bg-transparent dark:disabled:bg-transparent",none:"text-(--ui-text-highlighted) bg-transparent"},color:{primary:"",secondary:"",success:"",info:"",warning:"",error:"",neutral:""},leading:{true:""},trailing:{true:""},loading:{true:""},highlight:{true:""},type:{file:"file:me-1.5 file:font-medium file:text-(--ui-text-muted) file:outline-none"}},compoundVariants:[{color:"primary",variant:["outline","subtle"],class:"focus-visible:ring-2 focus-visible:ring-inset focus-visible:ring-(--ui-primary)"},{color:"secondary",variant:["outline","subtle"],class:"focus-visible:ring-2 focus-visible:ring-inset focus-visible:ring-(--ui-secondary)"},{color:"success",variant:["outline","subtle"],class:"focus-visible:ring-2 focus-visible:ring-inset focus-visible:ring-(--ui-success)"},{color:"info",variant:["outline","subtle"],class:"focus-visible:ring-2 focus-visible:ring-inset focus-visible:ring-(--ui-info)"},{color:"warning",variant:["outline","subtle"],class:"focus-visible:ring-2 focus-visible:ring-inset focus-visible:ring-(--ui-warning)"},{color:"error",variant:["outline","subtle"],class:"focus-visible:ring-2 focus-visible:ring-inset focus-visible:ring-(--ui-error)"},{color:"primary",highlight:!0,class:"ring ring-inset ring-(--ui-primary)"},{color:"secondary",highlight:!0,class:"ring ring-inset ring-(--ui-secondary)"},{color:"success",highlight:!0,class:"ring ring-inset ring-(--ui-success)"},{color:"info",highlight:!0,class:"ring ring-inset ring-(--ui-info)"},{color:"warning",highlight:!0,class:"ring ring-inset ring-(--ui-warning)"},{color:"error",highlight:!0,class:"ring ring-inset ring-(--ui-error)"},{color:"neutral",variant:["outline","subtle"],class:"focus-visible:ring-2 focus-visible:ring-inset focus-visible:ring-(--ui-border-inverted)"},{color:"neutral",highlight:!0,class:"ring ring-inset ring-(--ui-border-inverted)"},{leading:!0,size:"xs",class:"ps-7"},{leading:!0,size:"sm",class:"ps-8"},{leading:!0,size:"md",class:"ps-9"},{leading:!0,size:"lg",class:"ps-10"},{leading:!0,size:"xl",class:"ps-11"},{trailing:!0,size:"xs",class:"pe-7"},{trailing:!0,size:"sm",class:"pe-8"},{trailing:!0,size:"md",class:"pe-9"},{trailing:!0,size:"lg",class:"pe-10"},{trailing:!0,size:"xl",class:"pe-11"},{loading:!0,leading:!0,class:{leadingIcon:"animate-spin"}},{loading:!0,leading:!1,trailing:!0,class:{trailingIcon:"animate-spin"}}],defaultVariants:{size:"md",color:"primary",variant:"outline"}},Ne=["id","value","name","rows","placeholder","disabled","required"],Me=re;var ee;const Ie=Q({extend:Q(Ve),...((ee=Me.ui)==null?void 0:ee.textarea)||{}}),ze=te({inheritAttrs:!1,__name:"Textarea",props:W({as:{},id:{},name:{},placeholder:{},color:{},variant:{},size:{},required:{type:Boolean},autofocus:{type:Boolean},autofocusDelay:{default:0},disabled:{type:Boolean},class:{},rows:{default:3},maxrows:{default:0},autoresize:{type:Boolean},highlight:{type:Boolean},ui:{}},{modelValue:{},modelModifiers:{}}),emits:W(["update:modelValue","blur","change"],["update:modelValue"]),setup(A,{expose:h,emit:k}){const c=A,S=k,[T,p]=le(A,"modelValue"),{emitFormFocus:R,emitFormBlur:L,emitFormInput:$,emitFormChange:n,size:N,color:F,id:C,name:B,highlight:H,disabled:P,ariaAttrs:M}=ue(c,{deferInputValidation:!0}),O=ae(()=>Ie({color:F.value,variant:c.variant,size:N==null?void 0:N.value,highlight:H.value})),f=w(null);function U(){var o;c.autofocus&&((o=f.value)==null||o.focus())}function I(o){p.trim&&(o=(o==null?void 0:o.trim())??null),p.number&&(o=pe(o)),p.nullify&&(o||(o=null)),T.value=o,$()}function x(o){z(),p.lazy||I(o.target.value)}function E(o){const b=o.target.value;p.lazy&&I(b),p.trim&&(o.target.value=b.trim()),n(),S("change",o)}function K(o){L(),S("blur",o)}j(()=>{setTimeout(()=>{U()},c.autofocusDelay)});function z(){if(c.autoresize){if(!f.value)return;f.value.rows=c.rows;const o=f.value.style.overflow;f.value.style.overflow="hidden";const b=window.getComputedStyle(f.value),y=Number.parseInt(b.paddingTop),_=Number.parseInt(b.paddingBottom),e=y+_,t=Number.parseInt(b.lineHeight),{scrollHeight:r}=f.value,d=(r-e)/t;d>c.rows&&(f.value.rows=c.maxrows?Math.min(d,c.maxrows):d),f.value.style.overflow=o}}return se(T,()=>{fe(z)}),h({textareaRef:f}),j(()=>{setTimeout(()=>{z()},100)}),(o,b)=>{var y;return q(),de(i(me),{as:o.as,class:ie(O.value.root({class:[c.class,(y=c.ui)==null?void 0:y.root]}))},{default:u(()=>{var _;return[s("textarea",ge({id:i(C),ref_key:"textareaRef",ref:f,value:i(T),name:i(B),rows:o.rows,placeholder:o.placeholder,class:O.value.base({class:(_=c.ui)==null?void 0:_.base}),disabled:i(P),required:o.required},{...o.$attrs,...i(M)},{onInput:x,onBlur:K,onChange:E,onFocus:b[0]||(b[0]=(...e)=>i(R)&&i(R)(...e))}),null,16,Ne),ce(o.$slots,"default")]}),_:3},8,["as","class"])}}}),Re=Object.assign(ze,{__name:"UTextarea"}),Ce={class:"flex items-center justify-between"},Oe={class:"text-sm text-gray-500"},Ue={class:"text-sm text-blue-500"},Ee={class:"space-y-1"},Ae={class:"text-sm"},Le={class:"text-sm text-gray-500"},$e={class:"text-sm text-blue-500"},Fe={class:"text-sm text-green-500"},Be={class:"text-sm text-green-500"},He={class:"flex items-center"},Pe={class:"text-sm text-gray-500"},Ke={class:"flex items-center gap-2"},Ye={class:"text-xl font-semibold"},je={class:"grid grid-cols-2 gap-6"},qe={class:"space-y-2"},Ge={key:0,class:"text-sm text-gray-500"},Xe={class:"space-y-2"},Qe={class:"space-y-2"},We={class:"space-y-2"},Je={class:"space-y-2"},Ze={class:"space-y-2"},et={class:"space-y-2"},tt={class:"flex justify-end gap-3"},mt=te({__name:"index",setup(A){const h=w(!1),k=w(!0),c=w(!1),S=w(!1),T=w([]),p=w(null),{data:R,refresh:L}=Z("/api/users","$D43zP0MEy-"),$=ae(()=>(R.value||[]).map(e=>({label:`${e.name} (${e.email})`,value:e._id}))),n=be({amountVND:null,term:"",interestRate:null,borrowerId:"",loanDate:"",interestStartDate:"",description:""}),N=[{label:"3 tháng",value:"3_MONTHS"},{label:"6 tháng",value:"6_MONTHS"},{label:"1 năm",value:"1_YEAR"}],F=[{accessorKey:"amount",header:"Số tiền"},{accessorKey:"usage",header:"Sử dụng"},{accessorKey:"term",header:"Kỳ hạn"},{accessorKey:"interestRate",header:"Lãi suất"},{accessorKey:"borrower",header:"Người vay"},{accessorKey:"dates",header:"Thời gian"},{accessorKey:"status",header:"Trạng thái"},{accessorKey:"actions",header:"Thao tác"}],C=e=>e?new Date(e).toISOString().split("T")[0]:"",B=(e,t)=>{if(!e)return"NOT_STARTED";const r=new Date,d=new Date(e);let v=new Date(d);switch(t){case"3_MONTHS":v.setMonth(d.getMonth()+3);break;case"6_MONTHS":v.setMonth(d.getMonth()+6);break;case"1_YEAR":v.setFullYear(d.getFullYear()+1);break}return r<d?"NOT_STARTED":r>v?"COMPLETED":"IN_PROGRESS"},{data:H,refresh:P}=Z("/api/loans","$c8-PWuVdq0");se(H,e=>{T.value=(e||[]).map(t=>({...t,status:B(t.interestStartDate,t.term)})),k.value=!1},{immediate:!0});const M=async()=>{try{k.value=!0,await P()}catch(e){console.error("Error fetching loans:",e)}finally{k.value=!1}},O=e=>{var t;p.value=e,Object.assign(n,{amountVND:e.amountVND,term:e.term,interestRate:e.interestRate,borrowerId:(t=e.borrowerId)==null?void 0:t._id,loanDate:C(e.loanDate),interestStartDate:C(e.interestStartDate),description:e.description}),h.value=!0},f=async e=>{try{S.value=!0,await $fetch(`/api/loans/${e}`,{method:"DELETE"}),await M()}catch(t){console.error("Error deleting loan:",t)}finally{S.value=!1}},U=async()=>{try{c.value=!0;const e={...n};p.value?await $fetch(`/api/loans/${p.value._id}`,{method:"PATCH",body:e}):await $fetch("/api/loans",{method:"POST",body:e}),await M(),I()}catch(e){console.error("Error submitting loan:",e)}finally{c.value=!1}},I=()=>{h.value=!1,p.value=null,Object.assign(n,{amountVND:null,term:"",interestRate:null,borrowerId:"",loanDate:"",interestStartDate:"",description:""})},x=e=>new Intl.NumberFormat("vi-VN").format(e),E=e=>new Date(e).toLocaleDateString("vi-VN"),K=e=>({"3_MONTHS":"3 tháng","6_MONTHS":"6 tháng","1_YEAR":"1 năm"})[e]||e,z=e=>({NOT_STARTED:"Chưa tính lãi",IN_PROGRESS:"Đang tính lãi",COMPLETED:"Đã kết thúc"})[e]||e,o=e=>({NOT_STARTED:"yellow",IN_PROGRESS:"blue",COMPLETED:"green"})[e]||"gray",b=e=>(e/24500).toFixed(2),y=e=>{if(!e.interestStartDate||!e.term||!e.amountVND||!e.interestRate)return 0;const t=new Date,r=new Date(e.interestStartDate);if(t<r)return 0;let d=new Date(r);switch(e.term){case"3_MONTHS":d.setMonth(r.getMonth()+3);break;case"6_MONTHS":d.setMonth(r.getMonth()+6);break;case"1_YEAR":d.setFullYear(r.getFullYear()+1);break}const v=e.interestRate/100/365;if(t>d){const V=Math.ceil((d.getTime()-r.getTime())/864e5);return e.amountVND*v*V}const Y=Math.ceil((t.getTime()-r.getTime())/(1e3*60*60*24));return e.amountVND*v*Y},_=e=>{if(!e.purchasedMX||!e.totalRewards)return 0;const t=e.totalRewards*25e3,r=y(e);return t-r};return j(()=>{M(),L()}),(e,t)=>{const r=he,d=_e,v=De,Y=we,V=ke,G=Se,oe=Re,ne=Te;return q(),J("div",null,[g(Y,null,{header:u(()=>[s("div",Ce,[t[10]||(t[10]=s("h2",{class:"text-xl font-semibold"},"Quản lý khoản vay",-1)),g(r,{icon:"i-heroicons-plus",color:"primary",onClick:t[0]||(t[0]=a=>h.value=!0)},{default:u(()=>t[9]||(t[9]=[m(" Thêm khoản vay ")])),_:1})])]),default:u(()=>[g(v,{data:i(T),columns:F,loading:i(k)},{"amount-cell":u(({row:a})=>[m(l(x(a.original.amountVND))+" VND ",1),s("div",Oe," ≈ "+l(a.original.amountUSDT)+" USDT ",1),s("div",Ue," Lãi phải trả: "+l(x(y(a.original)))+" VND ",1)]),"usage-cell":u(({row:a})=>{var D,X;return[s("div",Ee,[s("div",Ae," Đã sử dụng: "+l(x(a.original.usedAmount))+" USDT ",1),s("div",Le," Còn lại: "+l(x(a.original.remainingAmount))+" USDT ",1),s("div",$e," Đã mua: "+l(((D=a.original.purchaseHistory)==null?void 0:D.length)||0)+" lần ",1),s("div",Fe," Số MX đã mua: "+l(((X=a.original.purchasedMX)==null?void 0:X.toFixed(2))||"0")+" MX ",1),s("div",Be," Số tiền đã thu về: "+l(x(a.original.totalRewards))+" USDT ",1),s("div",{class:ie(["text-sm",_(a.original)>=0?"text-success-500":"text-error-500"])}," Lời/Lỗ: "+l(x(_(a.original)))+" VND ",3)])]}),"term-cell":u(({row:a})=>[m(l(K(a.original.term)),1)]),"interest-rate-cell":u(({row:a})=>[s("div",He,[m(l(a.original.interestRate)+" ",1),t[11]||(t[11]=s("span",{class:"text-gray-500 ml-0.5"},"%",-1))])]),"borrower-cell":u(({row:a})=>{var D;return[m(l((D=a.original.borrowerId)!=null&&D.name?`${a.original.borrowerId.name} (${a.original.borrowerId.email})`:"N/A"),1)]}),"dates-cell":u(({row:a})=>[s("div",null,"Ngày vay: "+l(E(a.original.loanDate)),1),s("div",Pe," Bắt đầu tính lãi: "+l(E(a.original.interestStartDate)),1)]),"status-cell":u(({row:a})=>[g(d,{color:o(a.original.status),variant:"subtle",size:"sm"},{default:u(()=>[m(l(z(a.original.status)),1)]),_:2},1032,["color"])]),"actions-cell":u(({row:a})=>[s("div",Ke,[g(r,{color:"primary",variant:"ghost",icon:"i-heroicons-pencil-square",size:"xs",onClick:D=>O(a.original)},null,8,["onClick"]),g(r,{color:"red",variant:"ghost",icon:"i-heroicons-trash",size:"xs",loading:i(S),onClick:D=>f(a.original._id)},null,8,["loading","onClick"])])]),_:1},8,["data","loading"])]),_:1}),g(ne,{open:i(h),"onUpdate:open":t[8]||(t[8]=a=>ve(h)?h.value=a:null),"prevent-close":""},{header:u(()=>[s("div",Ye,l(i(p)?"Cập nhật khoản vay":"Thêm khoản vay mới"),1)]),body:u(()=>[s("form",{onSubmit:xe(U,["prevent"]),class:"space-y-6"},[s("div",je,[s("div",qe,[t[12]||(t[12]=s("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-200"},[m(" Số tiền vay (VND) "),s("span",{class:"text-red-500"},"*")],-1)),g(V,{modelValue:i(n).amountVND,"onUpdate:modelValue":t[1]||(t[1]=a=>i(n).amountVND=a),type:"number",placeholder:"Nhập số tiền VND",ui:{base:"relative block w-full disabled:cursor-not-allowed disabled:opacity-75 focus:outline-none border-0 form-input",padding:"pl-11 pr-4",leading:"absolute inset-y-0 left-0 flex items-center pl-3 text-gray-500 dark:text-gray-400",inner:"relative block w-full rounded-md h-[38px]"}},null,8,["modelValue"]),i(n).amountVND?(q(),J("div",Ge," ≈ "+l(b(i(n).amountVND))+" USDT ",1)):ye("",!0)]),s("div",Xe,[t[13]||(t[13]=s("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-200"},[m(" Kỳ hạn "),s("span",{class:"text-red-500"},"*")],-1)),g(G,{modelValue:i(n).term,"onUpdate:modelValue":t[2]||(t[2]=a=>i(n).term=a),items:N,placeholder:"Chọn kỳ hạn",ui:{select:{base:"relative block w-full disabled:cursor-not-allowed disabled:opacity-75 focus:outline-none border-0 form-select",inner:"relative block w-full rounded-md h-[38px]"}}},null,8,["modelValue"])]),s("div",Qe,[t[14]||(t[14]=s("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-200"},[m(" Lãi suất (%) "),s("span",{class:"text-red-500"},"*")],-1)),g(V,{modelValue:i(n).interestRate,"onUpdate:modelValue":t[3]||(t[3]=a=>i(n).interestRate=a),type:"number",min:"0",max:"20",step:"0.1",placeholder:"Nhập lãi suất",ui:{base:"relative block w-full disabled:cursor-not-allowed disabled:opacity-75 focus:outline-none border-0 form-input",inner:"relative block w-full rounded-md h-[38px]"}},null,8,["modelValue"])]),s("div",We,[t[15]||(t[15]=s("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-200"},[m(" Người vay "),s("span",{class:"text-red-500"},"*")],-1)),g(G,{modelValue:i(n).borrowerId,"onUpdate:modelValue":t[4]||(t[4]=a=>i(n).borrowerId=a),items:i($),searchable:"",placeholder:"Chọn người vay",ui:{select:{base:"relative block w-full disabled:cursor-not-allowed disabled:opacity-75 focus:outline-none border-0 form-select",inner:"relative block w-full rounded-md h-[38px]"}}},null,8,["modelValue","items"])]),s("div",Je,[t[16]||(t[16]=s("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-200"},[m(" Ngày vay "),s("span",{class:"text-red-500"},"*")],-1)),g(V,{modelValue:i(n).loanDate,"onUpdate:modelValue":t[5]||(t[5]=a=>i(n).loanDate=a),type:"date",ui:{base:"relative block w-full disabled:cursor-not-allowed disabled:opacity-75 focus:outline-none border-0 form-input",inner:"relative block w-full rounded-md h-[38px]"}},null,8,["modelValue"])]),s("div",Ze,[t[17]||(t[17]=s("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-200"},[m(" Ngày bắt đầu tính lãi "),s("span",{class:"text-red-500"},"*")],-1)),g(V,{modelValue:i(n).interestStartDate,"onUpdate:modelValue":t[6]||(t[6]=a=>i(n).interestStartDate=a),type:"date",ui:{base:"relative block w-full disabled:cursor-not-allowed disabled:opacity-75 focus:outline-none border-0 form-input",inner:"relative block w-full rounded-md h-[38px]"}},null,8,["modelValue"])])]),s("div",et,[t[18]||(t[18]=s("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-200"},[m(" Mô tả "),s("span",{class:"text-red-500"},"*")],-1)),g(oe,{modelValue:i(n).description,"onUpdate:modelValue":t[7]||(t[7]=a=>i(n).description=a),placeholder:"Nhập mô tả khoản vay",ui:{base:"relative block w-full disabled:cursor-not-allowed disabled:opacity-75 focus:outline-none border-0 form-textarea",padding:"py-2 px-3",inner:"relative block w-full rounded-md"},rows:3},null,8,["modelValue"])])],32)]),footer:u(()=>[s("div",tt,[g(r,{color:"gray",variant:"soft",onClick:I},{default:u(()=>t[19]||(t[19]=[m(" Hủy ")])),_:1}),g(r,{color:"primary",loading:i(c),onClick:U},{default:u(()=>[m(l(i(p)?"Cập nhật":"Thêm mới"),1)]),_:1},8,["loading"])])]),_:1},8,["open"])])}}});export{mt as default};
