import{f as K,r as u,C as R,j as q,g as z,c as y,b as s,w as n,A as I,x as a,o as h,a as l,q as L,d as i,t as p,D as P,O as U}from"./oqaamrP9.js";import{_ as H}from"./BNekpQR3.js";import{_ as F}from"./CpnDDUUJ.js";import{_ as Q}from"./DSWG5mB1.js";import{_ as Y}from"./BgNR3wsS.js";import{_ as Z}from"./DaOrRE6X.js";import{_ as G}from"./CGHGiu4z.js";import{u as J}from"./DuJY48Vi.js";import"./CRmWZ7WG.js";import"./C4ent8x3.js";import"./VH0Qlokb.js";const W={class:"flex items-center justify-between"},X={class:"flex items-center gap-2"},ee={class:"text-xl font-semibold"},oe={class:"grid grid-cols-2 gap-6"},te={class:"space-y-2"},le={class:"space-y-2"},ae={class:"space-y-2"},se={class:"block text-sm font-medium text-gray-700 dark:text-gray-200"},ne={key:0,class:"text-red-500"},re={key:0,class:"text-xs text-gray-500"},ie={class:"space-y-2"},de={class:"flex justify-end gap-3"},ke=K({__name:"index",setup(ce){const c=u(!1),f=u(!0),_=u(!1),g=u(!1),x=u([]),d=u(null),r=R({name:"",email:"",password:"",role:""}),V=[{label:"Admin",value:"ADMIN"},{label:"User",value:"USER"}],C=[{accessorKey:"name",header:"Tên thành viên",sortable:!0},{accessorKey:"email",header:"Email",sortable:!0},{accessorKey:"role",header:"Vai trò"},{accessorKey:"actions",header:"Thao tác"}],{data:E,refresh:S}=J("/api/users","$ZYMt2gV0Sx");q(E,o=>{x.value=o||[],f.value=!1},{immediate:!0});const v=async()=>{try{f.value=!0,await S()}catch(o){console.error("Error fetching users:",o)}finally{f.value=!1}},T=o=>{d.value=o,Object.assign(r,{name:o.name,email:o.email,role:o.role||"USER",password:""}),c.value=!0},$=async o=>{try{g.value=!0,await $fetch(`/api/users/${o}`,{method:"DELETE"}),await v(),M()}catch(e){console.error("Error deleting user:",e)}finally{g.value=!1}},k=async()=>{try{_.value=!0;const o={...r};d.value&&!o.password&&delete o.password,d.value?await $fetch(`/api/users/${d.value._id}`,{method:"PATCH",body:o}):await $fetch("/api/users",{method:"POST",body:o}),await v(),w()}catch(o){console.error("Error submitting user:",o)}finally{_.value=!1}},w=()=>{c.value=!1,d.value=null,Object.assign(r,{name:"",email:"",password:"",role:""})},M=()=>{const o=document.querySelector(".u-popover");o!=null&&o.close&&o.close()};return z(()=>{v()}),(o,e)=>{const m=L,N=H,D=F,O=Q,b=Y,j=Z,A=G;return h(),y("div",null,[s(O,null,{header:n(()=>[l("div",W,[e[7]||(e[7]=l("h2",{class:"text-xl font-semibold"},"Quản lý người dùng",-1)),s(m,{icon:"i-heroicons-plus",color:"primary",onClick:e[0]||(e[0]=t=>c.value=!0)},{default:n(()=>e[6]||(e[6]=[i(" Thêm người dùng ")])),_:1})])]),default:n(()=>[s(D,{data:a(x),columns:C,loading:a(f)},{"name-cell":n(({row:t})=>[i(p(t.original.name),1)]),"email-cell":n(({row:t})=>[i(p(t.original.email),1)]),"role-cell":n(({row:t})=>[s(N,{color:t.original.role==="ADMIN"?"red":"blue",variant:"subtle",size:"sm"},{default:n(()=>[i(p(t.original.role||"USER"),1)]),_:2},1032,["color"])]),"actions-cell":n(({row:t})=>[l("div",X,[s(m,{color:"primary",variant:"ghost",icon:"i-heroicons-pencil-square",size:"xs",onClick:B=>T(t.original)},null,8,["onClick"]),s(m,{color:"red",variant:"ghost",icon:"i-heroicons-trash",size:"xs",loading:a(g),onClick:B=>$(t.original._id)},null,8,["loading","onClick"])])]),_:1},8,["data","loading"])]),_:1}),s(A,{open:a(c),"onUpdate:open":e[5]||(e[5]=t=>I(c)?c.value=t:null),"prevent-close":""},{header:n(()=>[l("div",ee,p(a(d)?"Cập nhật người dùng":"Thêm người dùng mới"),1)]),body:n(()=>[l("form",{onSubmit:P(k,["prevent"]),class:"space-y-6"},[l("div",oe,[l("div",te,[e[8]||(e[8]=l("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-200"},[i(" Tên thành viên "),l("span",{class:"text-red-500"},"*")],-1)),s(b,{modelValue:a(r).name,"onUpdate:modelValue":e[1]||(e[1]=t=>a(r).name=t),placeholder:"Nhập tên thành viên",ui:{base:"relative block w-full disabled:cursor-not-allowed disabled:opacity-75 focus:outline-none border-0 form-input",padding:"pl-4 pr-4",inner:"relative block w-full rounded-md h-[38px]"}},null,8,["modelValue"])]),l("div",le,[e[9]||(e[9]=l("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-200"},[i(" Email "),l("span",{class:"text-red-500"},"*")],-1)),s(b,{modelValue:a(r).email,"onUpdate:modelValue":e[2]||(e[2]=t=>a(r).email=t),type:"email",placeholder:"Nhập địa chỉ email",ui:{base:"relative block w-full disabled:cursor-not-allowed disabled:opacity-75 focus:outline-none border-0 form-input",padding:"pl-4 pr-4",inner:"relative block w-full rounded-md h-[38px]"}},null,8,["modelValue"])]),l("div",ae,[l("label",se,[e[10]||(e[10]=i(" Mật khẩu ")),a(d)?U("",!0):(h(),y("span",ne,"*"))]),s(b,{modelValue:a(r).password,"onUpdate:modelValue":e[3]||(e[3]=t=>a(r).password=t),type:"password",placeholder:"Nhập mật khẩu",ui:{base:"relative block w-full disabled:cursor-not-allowed disabled:opacity-75 focus:outline-none border-0 form-input",padding:"pl-4 pr-4",inner:"relative block w-full rounded-md h-[38px]"}},null,8,["modelValue"]),a(d)?(h(),y("div",re," Để trống nếu không muốn thay đổi mật khẩu ")):U("",!0)]),l("div",ie,[e[11]||(e[11]=l("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-200"},[i(" Vai trò "),l("span",{class:"text-red-500"},"*")],-1)),s(j,{modelValue:a(r).role,"onUpdate:modelValue":e[4]||(e[4]=t=>a(r).role=t),items:V,placeholder:"Chọn vai trò",ui:{select:{base:"relative block w-full disabled:cursor-not-allowed disabled:opacity-75 focus:outline-none border-0 form-select",inner:"relative block w-full rounded-md h-[38px]"}}},null,8,["modelValue"])])])],32)]),footer:n(()=>[l("div",de,[s(m,{color:"gray",variant:"soft",onClick:w},{default:n(()=>e[12]||(e[12]=[i(" Hủy ")])),_:1}),s(m,{color:"primary",loading:a(_),onClick:k},{default:n(()=>[i(p(a(d)?"Cập nhật":"Thêm mới"),1)]),_:1},8,["loading"])])]),_:1},8,["open"])])}}});export{ke as default};
