import{f as R,r as s,j as X,g as J,c as Q,a as l,b as n,w as a,x as r,A as y,q as z,E as W,o as Y,d as f,t as $}from"./oqaamrP9.js";import{_ as Z}from"./DaOrRE6X.js";import{_ as ee}from"./BNekpQR3.js";import{_ as te}from"./CpnDDUUJ.js";import{_ as oe}from"./Bbln1Cgj.js";import{_ as ne}from"./DSWG5mB1.js";import{_ as ae}from"./BgNR3wsS.js";import{_ as le}from"./ila9M02m.js";import{_ as re}from"./CGHGiu4z.js";import"./CRmWZ7WG.js";import"./C4ent8x3.js";import"./VH0Qlokb.js";import"./CoQuO8dP.js";import"./BP0QYP2S.js";const se={class:"p-4"},ie={class:"flex justify-between items-center mb-6"},ce={class:"flex gap-2"},ue={class:"flex justify-between items-center"},de={class:"flex gap-2"},me={class:"flex items-center gap-2"},pe={class:"flex gap-2"},fe={class:"flex justify-between items-center"},ge={class:"flex justify-between items-center"},_e={class:"space-y-4"},ve={class:"flex justify-end gap-2"},ye={class:"flex justify-between items-center"},he={class:"p-4"},ke={class:"flex justify-end gap-2"},Ne=R({__name:"kickstarter",setup(xe){const S=[{key:"projectId",id:"projectId",header:"ID",accessorKey:"projectId"},{key:"name",id:"name",header:"Tên dự án",accessorKey:"name"},{key:"status",id:"status",header:"Trạng thái",accessorKey:"status"},{key:"startTime",formatter:o=>C(o),id:"startTime",header:"Bắt đầu",accessorKey:"startTime"},{key:"endTime",formatter:o=>C(o),id:"endTime",header:"Kết thúc",accessorKey:"endTime"},{key:"reward",id:"reward",header:"Phần thưởng",accessorKey:"reward"},{key:"actions",id:"actions",header:"Thao tác",accessorKey:"actions"}],h=s(!1),b=s([]),j=s(0),g=s(1),p=s(10),_=s(""),d=s(!1);s(!1);const c=s({projectId:"",name:"",description:"",startTime:"",endTime:"",status:"upcoming",reward:0,claimed:!1,createdAt:new Date,updatedAt:new Date}),k=s(!1),m=s(!1),v=s(null),x=s(!1);async function E(){h.value=!0;try{const e=await(await fetch(`/api/kickstarter?page=${g.value}&limit=${p.value}&status=${_.value}`)).json();b.value=e.projects,j.value=e.pagination.total}catch(o){console.error("Error fetching projects:",o)}finally{h.value=!1}}function u(){E()}function P(o){switch(o){case"upcoming":return"info";case"ongoing":return"success";case"ended":return"neutral";default:return"neutral"}}function I(o){switch(o){case"upcoming":return"Sắp tới";case"ongoing":return"Đang diễn ra";case"ended":return"Đã kết thúc";default:return o}}function C(o){return new Date(o).toLocaleString("vi-VN")}function K(o){return new Intl.NumberFormat("vi-VN",{minimumFractionDigits:2,maximumFractionDigits:2}).format(o)}function N(o){c.value={...o},console.log(c.value),d.value=!0}async function B(){try{await fetch(`/api/kickstarter/${c.value.projectId}/rewards`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({reward:c.value.reward,claimed:c.value.claimed})}),d.value=!1,u()}catch(o){console.error("Error saving rewards:",o)}}async function F(){k.value=!0;try{await fetch("/api/kickstarter/sync",{method:"POST"}),await u()}catch(o){console.error("Error syncing projects:",o)}finally{k.value=!1}}function L(o){v.value=o,m.value=!0}async function M(){if(v.value){x.value=!0;try{await fetch(`/api/kickstarter/${v.value.projectId}`,{method:"DELETE"}),m.value=!1,u()}catch(o){console.error("Error deleting project:",o)}finally{x.value=!1,v.value=null}}}return X([_,g,p],()=>{u()}),J(()=>{u()}),(o,e)=>{const i=z,T=Z,U=ee,A=te,H=oe,w=ne,q=ae,V=W("UFormGroup"),G=le,D=re;return Y(),Q("div",se,[l("div",ie,[e[13]||(e[13]=l("h1",{class:"text-2xl font-bold"},"Quản lý Kickstarter",-1)),l("div",ce,[n(i,{color:"primary",icon:"i-heroicons-arrow-path",onClick:u},{default:a(()=>e[11]||(e[11]=[f(" Làm mới ")])),_:1}),n(i,{color:"primary",icon:"i-heroicons-arrow-path",loading:r(k),onClick:F},{default:a(()=>e[12]||(e[12]=[f(" Đồng bộ ")])),_:1},8,["loading"])])]),n(w,null,{header:a(()=>[l("div",ue,[e[14]||(e[14]=l("h2",{class:"text-lg font-semibold"},"Danh sách dự án",-1)),l("div",de,[n(T,{modelValue:r(_),"onUpdate:modelValue":e[0]||(e[0]=t=>y(_)?_.value=t:null),options:[{label:"Tất cả",value:""},{label:"Sắp tới",value:"upcoming"},{label:"Đang diễn ra",value:"ongoing"},{label:"Đã kết thúc",value:"ended"}],class:"w-40"},null,8,["modelValue"])])])]),footer:a(()=>[l("div",fe,[n(H,{modelValue:r(g),"onUpdate:modelValue":[e[1]||(e[1]=t=>y(g)?g.value=t:null),u],total:r(j),"per-page":r(p)},null,8,["modelValue","total","per-page"]),n(T,{modelValue:r(p),"onUpdate:modelValue":[e[2]||(e[2]=t=>y(p)?p.value=t:null),u],options:[10,20,50,100],class:"w-24"},null,8,["modelValue"])])]),default:a(()=>[n(A,{columns:S,data:r(b),loading:r(h)},{"status-cell":a(({row:t})=>[n(U,{color:P(t.original.status),label:I(t.original.status)},null,8,["color","label"])]),"rewards-cell":a(({row:t})=>[l("div",me,[n(U,{color:t.original.claimed?"success":"neutral",label:t.original.claimed?"Đã nhận":"Chưa nhận"},null,8,["color","label"]),l("span",null,$(K(t.original.reward))+" USDT",1)])]),"actions-cell":a(({row:t})=>[l("div",pe,[n(i,{color:"primary",variant:"ghost",icon:"i-heroicons-pencil-square",onClick:O=>N(t.original)},null,8,["onClick"]),n(i,{color:"error",variant:"ghost",icon:"i-heroicons-trash",onClick:O=>L(t.original)},null,8,["onClick"])])]),_:1},8,["data","loading"])]),_:1}),n(D,{open:r(d),"onUpdate:open":e[7]||(e[7]=t=>y(d)?d.value=t:null)},{body:a(()=>[n(w,null,{header:a(()=>[l("div",ge,[e[15]||(e[15]=l("h3",{class:"text-lg font-semibold"},"Chỉnh sửa phần thưởng",-1)),n(i,{color:"neutral",variant:"ghost",icon:"i-heroicons-x-mark",onClick:e[3]||(e[3]=t=>d.value=!1)})])]),footer:a(()=>[l("div",ve,[n(i,{color:"neutral",variant:"ghost",onClick:e[6]||(e[6]=t=>d.value=!1)},{default:a(()=>e[16]||(e[16]=[f(" Hủy ")])),_:1}),n(i,{color:"primary",onClick:B},{default:a(()=>e[17]||(e[17]=[f(" Lưu ")])),_:1})])]),default:a(()=>[l("div",_e,[n(V,{label:"Số lượng USDT"},{default:a(()=>[n(q,{modelValue:r(c).reward,"onUpdate:modelValue":e[4]||(e[4]=t=>r(c).reward=t),type:"number",step:"0.01"},null,8,["modelValue"])]),_:1}),n(V,{label:"Trạng thái"},{default:a(()=>[n(G,{modelValue:r(c).claimed,"onUpdate:modelValue":e[5]||(e[5]=t=>r(c).claimed=t),label:"Đã nhận"},null,8,["modelValue"])]),_:1})])]),_:1})]),_:1},8,["open"]),n(D,{open:r(m),"onUpdate:open":e[10]||(e[10]=t=>y(m)?m.value=t:null)},{body:a(()=>[n(w,null,{header:a(()=>[l("div",ye,[e[18]||(e[18]=l("h3",{class:"text-lg font-semibold"},"Xác nhận xóa",-1)),n(i,{color:"neutral",variant:"ghost",icon:"i-heroicons-x-mark",onClick:e[8]||(e[8]=t=>m.value=!1)})])]),footer:a(()=>[l("div",ke,[n(i,{color:"neutral",variant:"ghost",onClick:e[9]||(e[9]=t=>m.value=!1)},{default:a(()=>e[20]||(e[20]=[f(" Hủy ")])),_:1}),n(i,{color:"error",loading:r(x),onClick:M},{default:a(()=>e[21]||(e[21]=[f(" Xóa ")])),_:1},8,["loading"])])]),default:a(()=>{var t;return[l("div",he,[l("p",null,'Bạn có chắc chắn muốn xóa dự án "'+$((t=r(v))==null?void 0:t.name)+'" không?',1),e[19]||(e[19]=l("p",{class:"text-sm text-gray-500 mt-2"},"Hành động này không thể hoàn tác.",-1))])]}),_:1})]),_:1},8,["open"])])}}});export{Ne as default};
